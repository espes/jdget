<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>eventlistener.html</title>
  <link rel="stylesheet" type="text/css" charset="utf-8" href="pycco.css">
</head>
<body>
<div id="background"></div>
<div id='container'>
  
  <div class='section'>
    <div class='docs'><h1>eventlistener.html</h1></div>
  </div>
  <div class='clearall'>
  <div class='section' id='section-0'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-0'>#</a>
      </div>
      <h2>JDownloader API Examples - Event Listener</h2>
<p>This example shows you how to listen to events on the event stream.
Using Firebug or Chrome Dev tools to inspect the console output of this example is highly recommended.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="cp">&lt;!doctype html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;utf-8&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;//ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;../src/jdapi.jquery.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script&gt;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-1'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-1'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="c1">//! jQuery JSON Plugin stripped</span>
<span class="c1">//! This plugin is licensed as free software under the terms of the MIT License: http://www.opensource.org/licenses/mit-license.php</span>
<span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$</span><span class="p">){</span><span class="nx">$</span><span class="p">.</span><span class="nx">toJSON</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">o</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="nx">JSON</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;object&#39;</span><span class="o">&amp;&amp;</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">)</span><span class="k">return</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">o</span><span class="p">);</span><span class="kd">var</span> <span class="nx">type</span><span class="o">=</span><span class="k">typeof</span><span class="p">(</span><span class="nx">o</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="nx">o</span><span class="o">===</span><span class="kc">null</span><span class="p">)</span><span class="k">return</span><span class="s2">&quot;null&quot;</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">type</span><span class="o">==</span><span class="s2">&quot;undefined&quot;</span><span class="p">)</span><span class="k">return</span> <span class="kc">undefined</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">type</span><span class="o">==</span><span class="s2">&quot;number&quot;</span><span class="o">||</span><span class="nx">type</span><span class="o">==</span><span class="s2">&quot;boolean&quot;</span><span class="p">)</span><span class="k">return</span> <span class="nx">o</span><span class="o">+</span><span class="s2">&quot;&quot;</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">type</span><span class="o">==</span><span class="s2">&quot;string&quot;</span><span class="p">)</span><span class="k">return</span> <span class="nx">$</span><span class="p">.</span><span class="nx">quoteString</span><span class="p">(</span><span class="nx">o</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="nx">type</span><span class="o">==</span><span class="s1">&#39;object&#39;</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">o</span><span class="p">.</span><span class="nx">toJSON</span><span class="o">==</span><span class="s2">&quot;function&quot;</span><span class="p">)</span><span class="k">return</span> <span class="nx">$</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">());</span><span class="k">if</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">constructor</span><span class="o">===</span><span class="nb">Array</span><span class="p">){</span><span class="kd">var</span> <span class="nx">ret</span><span class="o">=</span><span class="p">[];</span><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">o</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="nx">ret</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">(</span><span class="nx">o</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span><span class="o">||</span><span class="s2">&quot;null&quot;</span><span class="p">);</span><span class="k">return</span><span class="s2">&quot;[&quot;</span><span class="o">+</span><span class="nx">ret</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;]&quot;</span><span class="p">}</span><span class="kd">var</span> <span class="nx">pairs</span><span class="o">=</span><span class="p">[];</span><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">k</span> <span class="k">in</span> <span class="nx">o</span><span class="p">){</span><span class="kd">var</span> <span class="nx">name</span><span class="p">;</span><span class="kd">var</span> <span class="nx">type</span><span class="o">=</span><span class="k">typeof</span> <span class="nx">k</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">type</span><span class="o">==</span><span class="s2">&quot;number&quot;</span><span class="p">)</span><span class="nx">name</span><span class="o">=</span><span class="s1">&#39;&quot;&#39;</span><span class="o">+</span><span class="nx">k</span><span class="o">+</span><span class="s1">&#39;&quot;&#39;</span><span class="p">;</span><span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">type</span><span class="o">==</span><span class="s2">&quot;string&quot;</span><span class="p">)</span><span class="nx">name</span><span class="o">=</span><span class="nx">$</span><span class="p">.</span><span class="nx">quoteString</span><span class="p">(</span><span class="nx">k</span><span class="p">);</span><span class="k">else</span> <span class="k">continue</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">o</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;function&quot;</span><span class="p">)</span><span class="k">continue</span><span class="p">;</span><span class="kd">var</span> <span class="nx">val</span><span class="o">=</span><span class="nx">$</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">(</span><span class="nx">o</span><span class="p">[</span><span class="nx">k</span><span class="p">]);</span><span class="nx">pairs</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">name</span><span class="o">+</span><span class="s2">&quot;:&quot;</span><span class="o">+</span><span class="nx">val</span><span class="p">)}</span><span class="k">return</span><span class="s2">&quot;{&quot;</span><span class="o">+</span><span class="nx">pairs</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;}&quot;</span><span class="p">}}})(</span><span class="nx">jQuery</span><span class="p">);</span>
<span class="c1">//! http://paulirish.com/2009/log-a-lightweight-wrapper-for-consolelog/</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">log</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span><span class="nx">log</span><span class="p">.</span><span class="nx">history</span> <span class="o">=</span> <span class="nx">log</span><span class="p">.</span><span class="nx">history</span> <span class="o">||</span> <span class="p">[];</span><span class="nx">log</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span><span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">console</span><span class="p">)</span> <span class="p">{</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">))}};</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-2'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-2'>#</a>
      </div>
      <h2>Basic Setup</h2>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="nx">$</span><span class="p">.</span><span class="nx">jd</span><span class="p">.</span><span class="nx">setOptions</span><span class="p">({</span>
	<span class="nx">apiServer</span> <span class="o">:</span> <span class="s2">&quot;http://192.168.2.110:3128/&quot;</span><span class="p">,</span>
	<span class="nx">user</span> <span class="o">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span>
	<span class="nx">pass</span> <span class="o">:</span> <span class="s2">&quot;pass&quot;</span><span class="p">,</span>
	<span class="nx">debug</span> <span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
	<span class="nx">onerror</span> <span class="o">:</span> <span class="nx">log</span><span class="p">,</span>
	<span class="nx">onmessage</span><span class="o">:</span> <span class="nx">log</span>
<span class="p">});</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-3'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-3'>#</a>
      </div>
      <p>To get a connection to the event stream, we need an authenticated session.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="nx">$</span><span class="p">.</span><span class="nx">jd</span><span class="p">.</span><span class="nx">startSession</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">status</span> <span class="o">==</span> <span class="nx">$</span><span class="p">.</span><span class="nx">jd</span><span class="p">.</span><span class="nx">e</span><span class="p">.</span><span class="nx">sessionStatus</span><span class="p">.</span><span class="nx">REGISTERED</span><span class="p">)</span>
		<span class="nx">onSession</span><span class="p">();</span>
	<span class="k">else</span>
		<span class="nx">log</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="s2">&quot;Session could not be started.&quot;</span><span class="p">);</span>
<span class="p">});</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-4'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-4'>#</a>
      </div>
      <p>We received a session, start polling.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="kd">function</span> <span class="nx">onSession</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">$</span><span class="p">.</span><span class="nx">jd</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span><span class="nx">onmessage</span><span class="p">);</span> <span class="c1">//Subscribe to all events using &quot;*&quot;</span>
	<span class="nx">$</span><span class="p">.</span><span class="nx">jd</span><span class="p">.</span><span class="nx">startPolling</span><span class="p">();</span>
<span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-5'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-5'>#</a>
      </div>
      <h2>Listen to the event stream</h2>
<p>The API Event stream informs you about recent events in JDownloader.
Listening to the event stream, you can stay up to date without repolling.
As JD throws a lot of events, you have to subscribe to certain namespaces in order to get their events.
To do so, you can use the <code>subscribe()</code> and <code>unsubscribe()</code> functions. See jdapi.jquery.js docs for further details.
We're subscribing to all events using "*" as namespace, replacing the onmessage setting with our callback function.</p>
<p><strong>General Event specification:</strong><br/>
<pre>{
    "message":   "event identifier",
    "data":   eventData
}
</pre><strong>onmessage specification:</strong><br/>
<pre>function <code>onmessage</code> ( <code>event</code>, <code>namespace</code>, <code>pid</code>)
</pre>
<strong>event:</strong> An event object matching the general specification.<br/>
<strong>namespace:</strong> An integer containing the corresponding namespace<br/>
<strong>pid:</strong> An integer containing the corresponding PID<br/>
Some send() API calls cause [multiple] asynchronous responses.
Each asynchronous response comes over the regular event stream and is bundled with its PID
(which is announced to the client on the initiating API call).
Every event that comes with an valid PID has been caused by a specific API call.
If you supply a custom callback function within the API call (<em>see jQuery.jd.send</em>) <strong>and</strong>
this function returns <code>false</code> on a certain event, this event won't get passed to the onmessage callback.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="kd">function</span> <span class="nx">onmessage</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span><span class="nx">namespace</span><span class="p">,</span><span class="nx">pid</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">log</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">namespace</span><span class="p">,</span> <span class="nx">pid</span><span class="p">);</span>
	<span class="nx">$</span><span class="p">(</span><span class="s2">&quot;pre&quot;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; in &quot;</span><span class="o">+</span><span class="nx">namespace</span><span class="o">+</span><span class="p">(</span><span class="nx">pid</span> <span class="o">?</span> <span class="p">(</span><span class="s2">&quot; (&quot;</span><span class="o">+</span><span class="nx">pid</span><span class="o">+</span><span class="s2">&quot;)&quot;</span><span class="p">)</span> <span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;\n&quot;</span><span class="p">);</span>
<span class="p">}</span>
<span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
	<span class="nt">&lt;h4&gt;</span>Event Stream live dump<span class="nt">&lt;/h4&gt;</span>
	<span class="nt">&lt;pre&gt;&lt;/pre&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>

</pre></div>
    </div>
  </div>
  <div class='clearall'></div>
</div>
</body>
