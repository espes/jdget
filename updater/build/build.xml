<project default="jarWebupdater" basedir=".">
	<!-- Dependencies -->
	<property name="dep.awu" value="../AppWorkUtils" />
	<property name="dep.browser" value="../JDBrowser" />
	<property name="dep.updateclient" value="../UpdateClient" />
	<property name="dep.update" value="../JDUpdater" />
	<property name="debug" value="true" />



	<property name="working" value="update" />
	<property name="cls" value="${working}/bin" />
	<property name="dist" value="${working}/dist" />




	<path id="classpath">
		<fileset dir="${cls}" />
		<!-- Dependencies -->
		<fileset dir="${dep.awu}/libs" includes="**/*.jar" />
		<fileset dir="${dep.browser}/libs" includes="**/*.jar" />
		<fileset dir="${dep.updateclient}/libs" includes="**/*.jar" />
	</path>

	<!-- Deletes the old build -->
	<target name="clean">

		<delete dir="${working}/bin" />
		<delete dir="${dist}" />
		<mkdir dir="${dist}" />
		<mkdir dir="${working}" />
	</target>

	<!-- Compiles the code -->
	<target name="compile" depends="clean">
		<mkdir dir="${cls}" />

		<!-- Build dependencies -->

		<javac srcdir="${dep.awu}/src" excludes="**/test/**" debug="${debug}" destdir="${cls}" encoding="UTF-8" source="1.6" target="1.6" includeantruntime="false">
			<classpath refid="classpath" />

		</javac>

		<javac srcdir="${dep.browser}/src" excludes="" debug="${debug}" destdir="${cls}" encoding="UTF-8" source="1.6" target="1.6" includeantruntime="false">
			<classpath refid="classpath" />

		</javac>



		<javac srcdir="${dep.updateclient}/src" excludes="" debug="${debug}" destdir="${cls}" encoding="UTF-8" source="1.6" target="1.6" includeantruntime="false">
			<classpath refid="classpath" />

		</javac>

		<javac srcdir="src" debug="${debug}" excludes="" destdir="${cls}" encoding="UTF-8" source="1.6" target="1.6" includeantruntime="false">
			<classpath refid="classpath" />

		</javac>

		<echo message="Finished." />
	</target>






	<!--Webupdater-->
	<target name="jarWebupdater" depends="compile">
		<mkdir dir="${working}/dist/${theme}" />
		<manifest file="${working}/Manifest.MF">
			<attribute name="Created-By" value="AppWork GmbH" />
			<attribute name="Main-Class" value="org.appwork.update.Main" />
		</manifest>
		<jar file="${working}/dist/${theme}/Updater.jar" manifest="${working}/Manifest.MF">
			<zipfileset src="${dep.awu}/libs/miglayout.jar" excludes="META-INF/*" />
			<fileset dir="${working}">
				<include name="version.nfo" />
			</fileset>
			<fileset dir="${cls}">
				<include name="org/appwork/update/**/*" />
				<include name="org/appwork/controlling/**/*" />
				<include name="org/appwork/utils/logging/**/*" />
				<include name="org/appwork/storage/**/*" />
				<include name="org/appwork/exceptions/WTFException.class" />
				<include name="org/appwork/utils/images/**/*" />
				<include name="org/appwork/utils/swing/windowflasher/**/*" />
				<include name="org/appwork/scheduler/**/*" />
				<include name="org/appwork/resources/**/*" />
				<include name="org/appwork/app/**/*" />
				<include name="org/appwork/shutdown/**/*" />
				<include name="org/appwork/utils/net/**/*" />
				<include name="org/appwork/utils/parser/ShellParser.class" />
				<include name="org/appwork/net/**/*" />
				<include name="org/appwork/utils/*.class" />
				<include name="org/appwork/utils/formatter/**/*" />
				<include name="org/appwork/utils/event/**/*" />
				<include name="org/appwork/utils/locale/**/*" />
				<include name="org/appwork/utils/reflection/**/*" />
				<include name="org/appwork/txtresource/**/*" />
				<include name="org/appwork/utils/os/**/*" />
				<include name="org/appwork/utils/zip/**/*" />
				<include name="org/appwork/utils/swing/dialog/**/*" />
				<include name="org/appwork/utils/swing/*.class" />
				<include name="org/appwork/utils/ImageProvider/**/*" />


			</fileset>

			<fileset dir="themes">
				<include name="themes/${theme}/org/appwork/updater/**/*" />
			</fileset>
			<fileset dir="${dep.updateclient}/src">

				<include name="**/*.lng" />
				<include name="tbs.jar" />

			</fileset>
			<fileset dir="themes/themes/${theme}/org/appwork/updater/setup">
						<include name="**/*" />
			</fileset>

			<fileset dir="${dep.awu}/src">
				<include name="**/*.lng" />
			</fileset>

		</jar>
		<delete file="${working}/Manifest.MF" failonerror="false" />
	</target>








	<!-- Signs the jars -->
	<target name="sign">
		<signjar keystore="${appwork_java_cert}" alias="${appwork_java_cert_alias}" storepass="${appwork_java_cert_pass}">
			<path>
				<fileset dir="${dist}" includes="**/*.jar" />
			</path>
		</signjar>
	</target>



	<target name="updater" depends="clean,compile,jarWebupdater">
		<echo message="Finished." />
	</target>
</project>